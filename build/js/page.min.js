+function(t){"use strict";var e={queue:[],current:null,bomb:0,debug:!1},a=[],n=function(t){e.debug&&console.log(t)},s=function(t){if(!isFinite(t)||0>t)t="--:--";else{var e=Math.floor(t/60);t=Math.floor(t)%60,t=(10>e?"0"+e:e)+":"+(10>t?"0"+t:t)}return t},r=function(e){var a="";t.each(e,function(t,e){a+='<li class="nm-songlist-item"><span class="song-info">'+e.title+" - "+e.artist+'</span><span class="song-time">'+s(e.duration)+"</span></li>"}),t(".nm-songlist").html(a)},l=function(){var s=this;this.options={selector:"#nm_jplayer"},this.player=this.options.selector,s.init(),t(document).on("click",".nm-list-item",function(){var l=t(this);if(!l.hasClass("is-active")){t(".nm-list-item").removeClass("is-active"),l.addClass("is-active");var i=l.children(".nm-list-content").find(".music-info").text(),o=l.children(".nm-list-content").find(".music-cover").attr("src"),u=l.data("id"),m="dick"+u,c=t(".nm-songs"),p=nm_ajax_url.tworow?" threerow":"";t(".nmplaybar").addClass("appear");var d='<div class="nm-songs"><div class="nm-songs-title nm-container">'+i+'</div><div class="nm-songs-list nm-container"><ul class="nm-songlist'+p+'"></ul></div></div>';c.remove(),l.parent().after(d),e.current=m,t(".nmplayer-cover").css("background-image","url("+o+")"),a[m]?(r(a[m]),s.play(m,0)):t.ajax({type:"post",dataType:"json",url:nm_ajax_url.ajax_url,data:{action:"nmjson",id:u,type:l.data("type")},success:function(t){if(200==t.msg){t=t.song;var e=t.songs;r(e),a["dick"+u]=e,s.play(m,0)}}}),n(e.current)}}),t(s.player).bind(t.jPlayer.event.play,function(){var n=a[e.current][e.bomb];t(".nm-songlist-item").removeClass("current"),t(".nm-songlist-item").data("status","ready").removeClass("pause"),t(".nm-songlist-item").eq(e.bomb).data("status","play"),t(".nm-songlist-item").eq(e.bomb).addClass("current"),t(".nmplayer-title").html(n.title+" - "+n.artist),t(".nms-play-btn").removeClass("nm-play").addClass("nm-pause")}),t(s.player).bind(t.jPlayer.event.pause,function(){a[e.current][e.bomb];t(".nm-songlist-item").eq(e.bomb).data("status","pause").addClass("pause"),t(".nms-play-btn").removeClass("nm-pause").addClass("nm-play")}),t(s.player).bind(t.jPlayer.event.ended,function(){e.bomb<a[e.current].length?(e.bomb=e.bomb+1,s.play(e.current,e.bomb),t(s.player).jPlayer("play")):e.bomb=0}),t(document).on("click",".nm-songlist-item",function(){var a=t(this),r=a.index();"play"==a.data("status")?s.pause():"pause"==a.data("status")?s.play():(s.play(e.current,r),n("play "+r))}),t(".jp-progress").on("click",function(n){n.preventDefault();var r=t(this),l=r.offset().left,i=(n.pageX-l)/r.width(),o=a[e.current][e.bomb].duration;t(s.player).jPlayer("play",o*i)}),t(document).on("click",".nms-play-btn",function(){var e=t(this);e.hasClass("nm-play")?(n("player continue."),s.play()):(n("player pause."),s.pause())}),t(document).on("click",".nm-loadmore",function(){var e=t(this),a=e.data();e.hasClass("is-active")||(e.addClass("is-active"),t.ajax({url:nm_ajax_url.ajax_url,type:"POST",dataType:"json",data:a,success:function(a){return 200!=a.status?n("error"):(t(".nm-wrapper").append(a.data),a.nav?e.data("paged",a.nav):e.remove(),void e.removeClass("is-active"))}}))}),t(document).on("click",".nm-previous",function(){t(this);n("previous"),s.previous()}),t(document).on("click",".nm-next",function(){t(this);n("next"),s.next()})};l.prototype={init:function(){t(this.player).jPlayer({timeupdate:function(n){var r,r=n.jPlayer.status.currentTime,r=s(r),l=a[e.current][e.bomb].lrc,i=parseInt(n.jPlayer.status.currentTime);void 0!=l[i]&&t(".nmplayer-lrc").html(l[i]),t(".nmplayer-time").text(r),t(".nmplayer-prosess").css("transform","translateX("+(n.jPlayer.status.currentPercentAbsolute-100)+"%)")},supplied:"mp3",swfPath:nm_ajax_url.swfurl,solution:"html,flash",volume:1})},getJSON:function(e){t.ajax({type:"post",dataType:"json",url:nm_ajax_url.ajax_url,data:{action:"nmjson",id:e},success:function(t){if(200==t.msg){t=t.song;var n=t.songs;return a["dick"+e]=n,n}}})},play:function(e,a){"undefined"!=typeof e&&"undefined"!=typeof a&&this.select(e,a),t(this.player).jPlayer("play")},select:function(n,s){e.current=n,e.bomb=s,t(this.player).jPlayer("setMedia",a[e.current][e.bomb])},pause:function(){t(this.player).jPlayer("pause")},next:function(){var t=a[e.current].length;e.bomb!=t-1&&this.play(e.current,e.bomb+1)},previous:function(){e.bomb<1||(n(e.bomb),this.play(e.current,e.bomb-1))}};new l}(jQuery);